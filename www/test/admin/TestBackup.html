<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>backup test</title>
</head>
<body>
<p>This test assumes the backup to be valid from the start,
so it won't work if there is gaps or if backup files are from before the repository was reset.
Manually delete all the backup files to get a safe start.</p>
<p>If a verifyText fails, it might be because Selenium has stored old variable values.
Refresh the test suite to fix that.</p>
<table cellpadding="1" cellspacing="1" border="1">
<thead>
<tr><td rowspan="1" colspan="3">Run backup from admin page</td></tr>
</thead><tbody>
<tr title="first back up every existing revision">
	<td>open</td>
	<td>/repos/admin/backup/</td>
	<td></td>
</tr>
<tr>
	<td>open</td>
	<td>setup/?admin</td>
	<td></td>
</tr>
<tr>
	<td>verifyTextPresent</td>
	<td>At revision</td>
	<td></td>
</tr>
<tr>
	<td>storeText</td>
	<td>revision</td>
	<td>headrev</td>
</tr>
<tr>
	<td>verifyTextPresent</td>
	<td>sions from 0 to ${headrev} are backed up</td>
	<td></td>
</tr>
<tr>
	<td>open</td>
	<td>setup/?demoproject</td>
	<td></td>
</tr>
<tr>
	<td>clickAndWait</td>
	<td>createfolder</td>
	<td></td>
</tr>
<tr>
	<td>type</td>
	<td>name</td>
	<td>testbackup${headrev}</td>
</tr>
<tr>
	<td>clickAndWait</td>
	<td>submit</td>
	<td></td>
</tr>
<tr>
	<td>assertTextPresent</td>
	<td>Committed revision</td>
	<td></td>
</tr>
<tr>
	<td>open</td>
	<td>setup/?admin</td>
	<td></td>
</tr>
<tr title="head revision should have increased and backup revision should be the same">
	<td>verifyNotText</td>
	<td>revision</td>
	<td>${headrev}</td>
</tr>
<tr>
	<td>verifyText</td>
	<td>backuprevision</td>
	<td>${headrev}</td>
</tr>
<tr>
	<td>storeText</td>
	<td>revision</td>
	<td>headrev</td>
</tr>
<tr>
	<td>assertElementPresent</td>
	<td>backuprun</td>
	<td></td>
</tr>
<tr>
	<td>clickAndWait</td>
	<td>backuprun</td>
	<td></td>
</tr>
<tr>
	<td>assertTextPresent</td>
	<td>0 fails and 0 exceptions</td>
	<td></td>
</tr>
<tr>
	<td>clickAndWait</td>
	<td>link=admin</td>
	<td></td>
</tr>
<tr>
	<td>verifyText</td>
	<td>backuprevision</td>
	<td>${headrev}</td>
</tr>
<tr>
	<td>clickAndWait</td>
	<td>backupverify</td>
	<td></td>
</tr>
<tr title="This may report that MD5 sum contains sums from old test backups">
	<td>assertTextPresent</td>
	<td>0 fails and 0 exceptions</td>
	<td></td>
</tr>
</tbody></table>
</body>
</html>