<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Repos web application</title>
<link rel="shortcut icon" href="/favicon.ico"/>
<link href="style/global.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="scripts/head.js"></script>
<style type="text/css">
#releaseversion {
	font-weight: bold;
	color: #000000;
}
</style>
</head>
<body>

<div id="commandbar">
</div>

<div id="intro">
<h1>Repos Web</h1>
<p>Release <span id="releaseversion" class="versiondisplay">@Dev@</span></p>
</div>

<div class="column" style="width:33%">
<div class="section">
<h2>Server status</h2>
<p id="serverprimary"></p>
<script type="text/javascript">
$.getJSON('view/service/?s=SERVER', function(json) {
	$('#serverprimary').append(
		json.primary ? 'This is a primary server. It should host the main repository and the backup files.'
		: 'This is a repos mirror. It should host a readonly copy of the repository.');
});
</script>
<p>Client address: <span id="clientaddress"></span></p>
<p>Local client? <span id="clientlocal"></span></p>
<p>Admin client? <span id="clientadmin"></span></p>
<script type="text/javascript">
$.getJSON('view/service/?s=CLIENT', function(json) {
	$('#clientaddress').append(json.address);
	$('#clientlocal').append(json.local ? 'yes' : 'no');
	$('#clientadmin').append(json.admin ? 'yes' : 'no');
});
</script>
<p>License: <span id="license"></span></p>
<script type="text/javascript">
$.getJSON('view/service/?s=LICENSE', function(json) {
	if (json.length == 0 || !json.license) {
		$('#license').append('No license information available.');
	} else {
		$('#license').append('<em>' + json.license['Product-Name'] + '</em>'
			+ ' registered to <em>' + json.license['Registered-To'] + '</em>');
	}
});
</script>
</div>
</div>

<div class="column" style="width:33%">
<div id="repositorystatus" class="section">
<h2>Repository status</h2>
<!-- if this page is visited a lot, this section should probably be removed -->
<script type="text/javascript">
$.getJSON('view/service/?s=STATUS', function(json) {
	var div = $('#repositorystatus');
	div.append('<p>'+json.repository+'</p>')
		.append('<p>at version: <span class="revision">'+json.headrev+'</span></p>');
	if (json.lastrev) {
		div.append('<p>Backup exists up to version: <span class="revision">'+json.lastrev+'</span></p>');
		if (json.hasgaps) {
			div.append('<p class="error">There are backup gaps, please notify an administrator.</p>');
		}
	} else {
		div.append('<p class="warning">No backup archives found.</p>');
	}
});
</script>
</div>
</div>

<div class="column" style="width:33%">
<div id="libstatus" class="section">
<h2>Installed libraries</h2>
<!-- if this page is visited a lot, this section should probably be removed -->
<script type="text/javascript">
$.getJSON('lib/install.php', function(json) {
	var any = false;
	for (var id in json) {
		if (json[id].installed) {
			if (id=='smarty') any = true;
			$('#libstatus').append('<p>'+json[id].name+'</p>');
		}
	}
	if (!any) {
		$('#libstatus').append('<p>No 3rd party libraries installed. See <a href="lib/">lib/</a>.</p>');
	}
});
</script>
</div>
</div>

<div class="clearer"></div>

<div>
		<a id="serverroot" href="/" title="server root">startpage</a> &nbsp; 
		| &nbsp; <a id="login" href="/?login" title="Your account">log in</a> &nbsp;
		| &nbsp; <a id="lostpassword" href="account/reset/" title="Get temporary password">lost&nbsp;password?</a> &nbsp;
		| &nbsp; <a id="reposadmin" href="admin/">admin&nbsp;page</a> &nbsp;
		| &nbsp; <a id="accountcreate" href="account/create/" title="As administrator, create new login">admin&nbsp;create&nbsp;account</a> &nbsp; 
		| &nbsp; <a href="plugins/styleswitch/">select&nbsp;theme</a> &nbsp; 
		<!-- | &nbsp; <a href="docs/">online&nbsp;documentation</a> -->
<div>

<div id="footer">
This application makes use of cookies. 
See the Repos <a id="agreement" href="docs/agreement/" target="_blank">terms and conditions</a> before login.  

<span class="legal">
<span>Repos @Dev@</span>
&copy; 2007 repos.se
</span>
</div>

</body>
</html>
