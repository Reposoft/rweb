<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Copy or move repos item</title>
<!--{$head}-->
<script type="text/javascript">
function pasteUrl() {
	r='{=$repository}';
	url=prompt('Paste the full URL of the destination folder','');
	if (url==null) {
		return;
	}
	if (url.indexOf(r)!=0) {
		alert('The folder URL must begin with the repository URL '+r);
		return;
	}
	document.getElementsByName('tofolder')[0].value = url.substring(r.length);
}
function setMove(move) {
	button = document.getElementsByName('submit')[0].value = move ? "Move" : "Copy";
}
function checkType() {
	var localFilename = $('#name').val();
	if ($('#newname').val()) {
		var reposFilename = $('#newname').val();
		var i = reposFilename.match(/\.(\w*$)/);
		if (!i) {
			var j = localFilename.match(/\.(\w*$)/);
			if (j) {
				var reposFilenameWithType = reposFilename + j[0];
				$('#newname').val(reposFilenameWithType);
				return true;
			}
			return true;
		}
		return true;
	}
	return true;
}
</script>
</head>

<body>
<div id="commandbar">
<a id="repository" href="{=$repository}{=$folder|urlEncodeNames}">return to repository</a>
</div>
<div id="intro">
<h1>Copy or move <span class="filename">{=$oldname}</span></h1>
<p>Makes a copy of a file or folder at a new location in the repository.</p>
{=if not $file,isWritable} <p>You have read access only. You can only copy the file.</p>
{=elseif $file,isLockedByThisUser} <p>The file is currently <strong>locked</strong> by you, so other users can not edit it.
Select "delete the original" to make this a move operation.</p>
{=elseif $file,isLockedBySomeoneElse} <p>The file is currently <strong>locked</strong> by 
<span class="username">{=$file,lockOwner}</span> {=if $file,lockComment} with message &quot;<span class="message">{=$file,lockComment}</span>&quot;{=/if}. You can only copy the file.</p>
{=else}
<p>Select "delete the original" to make this a move operation.</p>
{=/if}
</div>
<div class="column" style="width: 60%">
<form id="copy" name="copy" method="get" action="#">
  <fieldset>
	<legend>make a copy of {=$target} inside repository {=$repository}</legend>
    <input name="target" type="hidden" id="target" value="{=$target}" />
  <p>
    <label for="name">copy the current</label>
    <input id="name" name="name" type="text" size="40" disabled="disabled" value="{=$oldname}" />
    <input id="oldname" name="oldname" type="hidden" value="{=$oldname}" />
  </p>
	<p>
		<label for="folder">from folder</label>
		<input id="folder" name="folder" type="text" size="40" disabled="disabled" value="{=$folder}" />	
	</p>
	<p>
		<label for="tofolder">to folder</label>
		<input id="tofolder" name="tofolder" type="text" size="40" value="{=$folder}" class="required" />	
		<a class="action" href="#" onclick="pasteUrl()">paste the full URL</a>	
	</p>
	<p>
		<label for="newname">name in new folder</label>
	   <input name="newname" type="text" id="newname" size="40" value="{=$oldname}" class="required" onchange="checkType()" />
	</p>
	<p>
		<label for="move">and delete the original</label>
		<input id="moveyes" name="move" type="radio" value="1" {=if not $file,isWritable || $file,isLockedBySomeoneElse}disabled="disabled"{=/if} onchange="setMove(this.checked)"/> Yes 
		<input id="moveno" name="move" type="radio" value="0" {=if not $file,isWritable || $file,isLockedBySomeoneElse}disabled="disabled"{=/if} checked="checked" onchange="setMove(!this.checked)" /> No
	</p>
  <p>
    <label for="message">history text</label>
    <textarea name="message" id="message" cols="30" rows="2" tabindex="2" ></textarea>
  </p>
  <p>
    <label for="submit"></label>
    <input id="submit" type="submit" name="submit" value="Copy" tabindex="3" />
  </p>
  </fieldset>
</form>
<p>Copies inside the repository take no extra storage space. A copy is just a reference to the current revision of a resource.
So a copy can be a good way to share a file as it looks now, but without sharing the future changes to the original.</p>
</div>
</body>
</html>
