<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Upload to repos</title>
<script type="text/javascript">
function autoFillFilename(path) {
<!--{if not $file}-->
	var pos = Math.max(path.lastIndexOf('/'), path.lastIndexOf('\\'));
	if (pos > 0) {
		var filename = path.substring(pos + 1);
		document.getElementsByName('name')[0].value = filename;
	}
<!--{/if}-->
}
</script>
<!--{$head}-->
</head>

<body>
<div id="contents">
<h1>Upload file</h1>
<!--{if $isfile}-->
<p>As a new version of file <span class="path">{=$target}</span>. <a class="action" target="_blank" href="../open/?target={=$target}">open current version</a></p>
<!--{else}-->
<p>As a new file in folder {=$target}</p>
<!--{/if}-->
<!--{if $isfile && !$isbinary}-->
<p>The current verison is a text file, so it is also possible to <a class="action" href="./?target={=$target}&text">copy-paste your local file's contents</a></p>
<!--{/if}-->
<!--{if !$isfile}-->
<p>It is also possible to <a class="action" href="./?target={=$target}&text">copy-paste your local file's contents</a></p>
<!--{/if}-->
<form action="./" method="post" enctype="multipart/form-data" name="formUpload" id="formUpload" tmt:validate="true">
<fieldset>
  <legend>Upload to repos.se</legend>
  <input type="hidden" name="targeturl" value="{=$targeturl}"/>
  <p>
    <label for="userfile">local file</label>
	<input type="hidden" name="MAX_FILE_SIZE" value="{=$maxfilesize}" />
    <input type="file" name="userfile" size="40" onchange="autoFillFilename(value)" tmt:required="true" tmt:message="Please select a file to upload"/>
  </p>
  <p>
    <label for="currentname">name in repository</label>
	<!--{if $isfile}-->
    <input type="text" id="currentname" name="currentname" value="{=$file}" disabled="disabled" size="40" />
	<input type="hidden" id="name" name="name" value="{=$target|basename}"/>
	<!--{else}-->
	<input type="text" id="name" name="name" size="40" tmt:required="true" tmt:pattern="reposFilename" tmt:message="Filename is required and may not contain ^, :, &amp;, <, >, @, #, ~, ?, *, $, |, [, ], /, \, commas or quotes"/>
	<input type="hidden" id="create" name="create" value="yes"/>
	<!--{/if}-->
  </p>
  <p>
    <label for="message">history text</label>
    <textarea id="message" name="message" cols="40" rows="2" tmt:pattern="reposLogmessage" tmt:message="Contains invalid characters"></textarea>
  </p>
  <p>
    <label for="submit"></label>
    <input id="submit" type="submit" name="Submit" value="Upload" />
  </p>
</fieldset>
</form>
<!--{if $file}-->
<p><a id="linkBack" class="action" href="{=$targeturl|dirname}">&lt; back</a></p>
<!--{else}-->
<p><a id="linkBack" class="action" href="{=$targeturl}">&lt; back</a></p>
<!--{/if}-->
</div>
</body>
</html>
