<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>repos: shared javascript</title>
<script type="text/javascript" src="../lib/jquery/jquery.js"></script>
<script type="text/javascript" src="../lib/cookie/jquery.cookie.js"></script>
<!-- the script, with a realistic url that can be used to find webappRoot -->
<script type="text/javascript" src="../../scripts/reposapi/repos.js"></script>
<!-- unit testing must be imported after Repos, so it can override functions -->
<script type="text/javascript" src="../unittest/testwalk.js"></script>
</head>

<body>
<h1>Repos shared script API</h1>
<ul>
<li><code>Repos.getWebapp() / Repos.url</code>
 (the web application root, with trailing slash)</li>
<li><code>:repos-service</code> and <code>:repos-target</code> <a href="selector.html">selectors</a></li>
<li><code>$.depends</code></li>
<li><code>Repos.getUser</code></li>
<li><code>$(selector)<a href="say.html">.say(message)</a></code> talk to the user</li>

</ul>
<p>
Dynamic loading of scripts and css has been disabled,
because it was not reliable. Can be found in reposweb-1.1-B1.
</p>

<h2>unit tests</h2>
<p>The unit test library overrides Repos.reportError, so it can't be tested, but the surrounding functions can be.</p>
<p>Hit Ctrl+Shift+L for Firebug light debug console.</p>

<script type="text/javascript">

assert($.depends,'$.depends plugin should be defined');
assert($.depends($.fn), jQuery, 'Existing object satisfies depends');
// TODO
assert($.depends($.NonExistingObject), 'No object, depends should return nothing (or empty bucket?)');
// Or should it be a selector?

// user functions
var USERNAME_KEY = 'account'; // cookie name from repos
var u = $.cookie(USERNAME_KEY);
$.cookie(USERNAME_KEY, 'bamse');
assert(Repos.getUser(), 'bamse', 'should get username from cookie when authenticated through repos');
$.cookie(USERNAME_KEY, null);
assert(Repos.getUser()===false, 'getUser should return false for no account');

</script>

</body>
</html>
