#!/bin/sh

set -e

if [ "$1" != "configure" ]; then
 exit 0
fi

for SAPI in apache cgi cli apache2
do
 if [ -f /etc/php4/$SAPI/php.ini ]
 then
  if grep -q eaccelerator.so /etc/php4/$SAPI/php.ini
  then
   echo "Not updating /etc/php4/$SAPI/php.ini, 'eaccelerator.so' alredy exists"
  else
   echo "Adding eaccelerator extension and configuration to /etc/php4/$SAPI/php.ini"
   echo "" >> /etc/php4/$SAPI/php.ini
   echo "; --- eaccelerator ----" >> /etc/php4/$SAPI/php.ini
   echo "extension=\"eaccelerator.so\"" >> /etc/php4/$SAPI/php.ini
   echo "eaccelerator.shm_size=\"16\"" >> /etc/php4/$SAPI/php.ini
   echo "eaccelerator.cache_dir=\"/tmp/eaccelerator\"" >> /etc/php4/$SAPI/php.ini
   echo "eaccelerator.enable=\"1\"" >> /etc/php4/$SAPI/php.ini
   echo "eaccelerator.optimizer=\"1\"" >> /etc/php4/$SAPI/php.ini
   echo "eaccelerator.check_mtime=\"1\"" >> /etc/php4/$SAPI/php.ini
   echo "eaccelerator.debug=\"0\"" >> /etc/php4/$SAPI/php.ini
   echo "eaccelerator.filter=\"\"" >> /etc/php4/$SAPI/php.ini
   echo "eaccelerator.shm_max=\"0\"" >> /etc/php4/$SAPI/php.ini
   echo "eaccelerator.shm_ttl=\"0\"" >> /etc/php4/$SAPI/php.ini
   echo "eaccelerator.shm_prune_period=\"0\"" >> /etc/php4/$SAPI/php.ini
   echo "eaccelerator.shm_only=\"0\"" >> /etc/php4/$SAPI/php.ini
   echo "eaccelerator.compress=\"1\"" >> /etc/php4/$SAPI/php.ini
   echo "eaccelerator.compress_level=\"9\"" >> /etc/php4/$SAPI/php.ini
  fi
 fi
done

exit 0
