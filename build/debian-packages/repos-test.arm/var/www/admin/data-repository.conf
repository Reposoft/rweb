# Users can commit to repositories on this server (comment out for mirrors)
SetEnvIf Request_Method ".*" REPOS_PRIMARY

# Repos Subversion configuration
<Location /data>
	AuthPAM_Enabled on
	AuthType Basic
	AuthName "repos"
	require valid-user
	
	DAV svn
	SVNPath /var/www/repo

	SVNIndexXSLT "/repos/view/repos.xsl"

	# Repository contents should be stale after 0 seconds
	SetEnvIf Request_URI ".*" !IS_STATIC
	Header add Cache-Control "max-age=0, must-revalidate"
</Location>

# Static contents are cached for 24 hours. Do upgrades on weekends.
<FilesMatch "\.(html|gif|png|jpe?g|ico|css|js|xsl)$">
	Header add Cache-Control "max-age=86400"
</FilesMatch>

# Repos error pages
ErrorDocument 400 /repos/errors/400/
ErrorDocument 401 /repos/errors/401/
ErrorDocument 403 /repos/errors/403/
ErrorDocument 404 /repos/errors/404/
ErrorDocument 500 /repos/errors/500/

# Administrative folders
Alias /backup /var/www/backup
<Directory "/var/www/backup">
	Options Indexes
        AuthPAM_Enabled on
        AuthType Basic
        AuthName "Repos"
        require user admin
</Directory>

<DirectoryMatch "^/var/www/html/repos/(conf|admin|test)">
	AuthPAM_Enabled on
        AuthType Basic
        AuthName "Repos"
        require user admin
</DirectoryMatch>

<Files "install.php">
	AuthPAM_Enabled on
        AuthType Basic
        AuthName "Repos"
        require user admin
	Allow from 127.0.0.1
	Satisfy Any
</Files>
