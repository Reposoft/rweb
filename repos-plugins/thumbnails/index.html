<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Repos thumbnails plugin</title>
<!-- plugins -->
<script type="text/javascript" src="/repos-web/scripts/lib/jquery/jquery.js"></script>
<script type="text/javascript" src="/repos-web/scripts/reposapi/repos.js"></script>
<!-- for unit testing -->
<script type="text/javascript" src="/repos-web/scripts/unittest/testwalk.js"></script>
<!-- css is loaded dynamically by unittest.js, so thumbnails will be loaded last -->
<script type="text/javascript" src="imagemagick.load.js"></script>
</head>
<body>

<h1>Repos thumbnailer plugin</h1>
<p>Thumbnails are created using imagemagick from a PHP script in this plugin folder.
Thumbnails are added to the interface using a javascript plugin.
This plugin identifies "open" links and adds thumbnail button. 
Should be possible, in repository view, to click a command that adds thumbnails to all image files in the list,
even when there are no "thmbnail" classes. 
Might be combined with thickbox to show the image in a popup instead of a new page when clicked.</p>
<p>If there are many thumbnails on a page, this plugin should do proper queuing, so that the first thumbnail is shown before the next is requested.</p>

<h2>Embed in page without javascript</h2>
<p>
<img src="/repos-plugins/thumbnails/convert/?target=/demoproject/trunk/public/images/b.gif&rev=" align="middle" border="1"/> 
&lt;- you should see an image with 1px border here (or a white pixel if thumbnailer is not installed).
</p>

<h2>Directory listing</h2>
<div id="commandbar"><span>some command</span>
<span id="fullpath" title="fullpath (ususally hidden)">/demoproject/trunk/public/images/</span>
</div>
<!--<div id="row:b.ai"><a id="open:b.ai" class="file" href="/demoproject/trunk/public/images/b.ai">b.ai</a></div>-->
<div id="row:b.png"><a id="open:b.png" class="file" href="/demoproject/trunk/public/images/b.png">b.png</a></div>

<!-- 
<h2>File history (not folder history)</h2>
<p>Thumbnail for each revision</p>
 -->
 
<h2>#intro div</h2>
<p><a href="view.html?target=/demoproject/trunk/public/images/b.jpg">without revision number</a></p>
<p><a href="view.html?target=/demoproject/trunk/public/images/b.jpg&rev=1">with revision number</a></p>
<p><a href="view.html?target=/demoproject/trunk/public/images/b.jpg&rev=99999999">Too high revision number</a>.
Currently there is no error message as image for this. Should be a rare type of error.
</p>
 
<h2>Error message as image</h2>
<p><img src="/repos-web/open/thumb/?target=/demoproject/trunk/nonexisting.gif&rev=1" align="middle" border="1"/>
Paste the image url in new window to get text error. Or use 'Display image' in firefox.
</p>

<h2>unit tests</h2>
<script type="text/javascript">
/*
function TestThumbnails() {
	this.name = 'TestDetails';
	
	this.setUp = function() {
	};
	
	this.testGetTargetFromTarget = function() {
		this.assertEquals('/a/folder/b.jpg',
			Repos.thumbnails.getTarget('/repos/open/open/?target=/a/folder/b.jpg'));
		this.assertEquals('/a/folder/b.jpg',
			Repos.thumbnails.getTarget('http://my.host/repos/open/?target=/a/folder/b.jpg'));
		this.assertEquals('/a/folder/f%20b.jpg',
			Repos.thumbnails.getTarget('/repos/open/?target=/a/folder/f%20b.jpg'));
	};
	
	this.testGetRev = function() {
		this.assertEquals('1234567', Repos.thumbnails.getRev('.../open/?target=a.b&rev=1234567'));
		this.assertEquals('2', Repos.thumbnails.getRev('.../open/?rev=2&target=c.d'));
		this.assertEquals('HEAD', Repos.thumbnails.getRev('.../e.jpg?rev=HEAD'));
		this.assertEquals('', Repos.thumbnails.getRev('/open/?rev=&target=a.b'));
		this.assertEquals('', Repos.thumbnails.getRev('/open/?target=a.b'));
	};
	
	this.testGetSrc = function() {
		this.assertEquals('/repos/open/thumb/?target=a.jpg&rev=12345',
			Repos.thumbnails.getSrc('a.jpg', 12345));
	};
	
	this.testGetSrcNoImage = function() {
		this.assertEquals(false,
			Repos.thumbnails.getSrc('a.bin', ''));
	}
	
}

testrun(TestThumbnails);
*/
</script>
</body>
</html>
