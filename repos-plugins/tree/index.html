<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Repos tree</title>
<link rel="stylesheet" type="text/css" media="all" href="tree.css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript">
//<![CDATA[
var reposweb = '/repos-web/';
var settings = {
	autoexpand: false
};
var json = reposweb+'open/json/'; // not using servicelayer
function expand(id,target) {
  var list = $('#'+id);
  var here = target;
  $.ajax({
    dataType: 'script',
    url: json+'?selector='+id+'&target='+encodeURI(here),
    success: function() {
		$('li.folder', list).each(function() {
			var a = $('a',this);
			var target = here + a.text()+'/'; // update in closure for recursion
			var id = Math.random().toString().substr(2);
			$('<ul/>').attr('id',id).appendTo(this);
			a.one('mouseover',
				function() {
					$(this).parent().addClass('loading');
					expand(id,target);
				});
			if (settings.autoexpand) a.trigger('mouseover');
		});
		list.parent().addClass('folder-open').removeClass('loading');
    },
    error: function(req, textStatus, errorThrown) {
    	// assume it is because we got access denied
		list.parent().addClass('folder-noaccess').removeClass('loading');
	}
  });
};
$().ready(function() {
	$('#target').text('/demoproject/trunk/');
	expand('root','/demoproject/trunk/');
	// extras
	reposTreeSidebar();
	reposTreePrint();
	reposTreeExpandAll();
});
function reposTreeSidebar() {
	if (!window.sidebar) return;
	var a = $('<a>').attr('href','#').text('as sidebar').appendTo('#commandbar').click(function() {
		window.sidebar.addPanel('Repos Treeview Sidebar', window.location.href, '');
	});
};
function reposTreePrint() {
	var a = $('<a>').attr('href','#').text('print tree').appendTo('#commandbar').click(function() {
		window.print();
	});
};
function reposTreeExpandAll() {
	var a = $('<a>').attr('href','#').text('expand all').appendTo('#commandbar').click(function() {
		settings.autoexpand = true;
		$('li.folder a').trigger('mouseover');
	});
};
//]]>
</script>

</head>
<body>
<div id="commandbar">
</div>

<h1 id="target"></h1>
<ul id="root">
</ul>

</body>
</html>