<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<title>Repos Quay demo and test page</title>

<!-- all this should be in a single repos-quay.js file one day, to include from any page -->
<script type="text/javascript" src="scripts/autosuggest.js"></script>
<script type="text/javascript">

/*
	This sourcecode is copyrighted... och nåt annat bra att säga...
*/
	document.write('<link href="css/repos-quay.css" rel="stylesheet" type="text/css" />');

	/*global vars*/
	var linkCache = new Array();
	var Q_KEY = 81;
	var ALT_KEY = 18;
	var ESC_KEY = 27;
	// the autosuggest object instance for the Quay
	var quaySuggest;

	function document_onKeyDown(e){
		var keyId = (window.event) ? event.keyCode : e.keyCode;
		var altDown = (ALT_KEY) ? true : false;
		
		if(keyId == Q_KEY && altDown){
			showQuay();
		}
		
		if(keyId == ESC_KEY) {
			hideQuay();
		}
	}
	
	function linkObject(anchorNode){
		// text will be an empty string if there is no matches, which means that the link can not be suggested
		var t = "";
		
		// if the link has textual contents, use it as suggestion text
		if (anchorNode.childNodes[0].data) {
			t = anchorNode.childNodes[0].data;
		}
		// also allow images as links
		else if (anchorNode.childNodes[0].tagName && anchorNode.childNodes[0].tagName == "IMG") {
			if(anchorNode.childNodes[0].title){
				t = anchorNode.childNodes[0].title;
			}
			else if(anchorNode.childNodes[0].alt){
				t = anchorNode.childNodes[0].alt;
			}
		}
				
		this.text = t.toString();
		this.url = anchorNode.href.toString();
	}
	
	function getQuayWindow(){
		return document.getElementById("quay");
	}
	
	function getQuayInputBox() {
		return document.getElementById("txtQuaySearch");
	}
	
	function printQuayDiv() {
		// currently included in the original HTML
	}
	
	// <!-- the box that will show matching links -->
	// <div id="autosuggest" style="z-index:65001;"><ul></ul></div>
	function printAutosuggestDiv() {
		var d = document.createElement("div");
		var u = document.createElement("ul");
		d.id = 'autosuggest';
		d.appendChild(u);
		document.body.appendChild(d);
	}
		
	function indexLinks(s){
		var as = document.body.getElementsByTagName("a");
		for(ix in as){
			if(as[ix].childNodes){
				linkCache.push(new linkObject(as[ix]));
			}
		}
	}
	
	function document_onLoad() {
		// run the indexing for autosuggest		  
		indexLinks();
		// print the quay HTML
		printQuayDiv();
		printAutosuggestDiv();
		// initiate autosuggest for the Quay inputbox
		quaySuggest = new AutoSuggest(getQuayInputBox(), linkCache);
		// make sure the Quay window is closed
		hideQuay();
	}
	
	function document_onUnload() {
		hideQuay();
	}
	
	function showQuay() {
		var qsWin = getQuayWindow();
		qsWin.style.display = 'block';
		var inputBox = getQuayInputBox();		
		inputBox.focus();
	}
	
	function hideQuay(){
		var qsWin = getQuayWindow();
		qsWin.style.display = 'none';
		quaySuggest.hideDiv();
	}
	
	// replace autosuggest onkeyup event handling (set event handling to false in autosuggest)
	function quay_onKeyUp() {
		quaySuggest.filter();
	}
	
	// allow keyboard events to show and hide the quay. Clicking the quay icons works without this.
	document.onkeydown = document_onKeyDown;
	
</script>
<style type="text/css">
/* should be in the css file included from the javascript */
input#txtQuaySearch {
	font-family: Verdana, Arial, Helvetica, sans-serif;
	font-size: 12px;
	font-weight: bold;
	color: #66667e;
	text-decoration: none;
	border: 1px solid #66667e;
	width: 100%;
}
div#quay_mainarea {
	background-color: #e0dfe3;
	padding: 10px;
}
div#quay_header {
	background-image: url(images/top_bar_center_part.gif);
	background-repeat: repeat-x;
	
	font-family: Verdana, Arial, Helvetica, sans-serif;
	font-size: 12px;
	font-weight: bold;
	color: #000000;
	text-decoration: none;
	height: 26px;
}

a#quayCloseIcon {
	position: absolute;
	top: 0px;
	right: 0px;
}

a#quayCloseIcon img {
	border: none;
}

/* test page font */
body {
	margin-left: 100px;
	font-family: Verdana, Arial, Helvetica, sans-serif;
	font-size: 0.7em;
}
</style>

</head>
<body onload="document_onLoad();" onunload="document_onUnload();">
<!-- all HTML needed for repos-quay. Remember to include the js-file -->
<a id="quayIcon" title="Go Alt+Q for Quay" accesskey="Q" href="#" onclick="javascript:showQuay()"><img src="images/q1.png" width="19" height="18" border="0" alt="Q"/></a>
<!-- end repos-quay html -->
<div id="demoBox">
<h1>Repos Quay demo</h1>
<p>This is a sample index page, but the Quay works for <a href="clicked.html?i=inline">inline</a> links too.</p>
<p><a href="clicked.html?i=up" title="Parent directory">..</a></p>
<p><a href="clicked.html?i=upup" title="Parent parent">../../</a></p>
<p><a href="clicked.html?i=folder%2F">folder/</a></p>
<p><a href="clicked.html?i=.project">.project</a></p>
<p><a href="clicked.html?i=document.html">document.html</a></p>
<p><a href="clicked.html?i=Document.html">Document.html</a></p>
<p><a href="clicked.html?i=samename.txt(1)">samename.txt</a> (1)</p>
<p><a href="clicked.html?i=samename.txt(2)">samename.txt</a> (2)</p>
<p><a href="clicked.html?i=sameurl.txt">sameURL.txt(1)</a></p>
<p><a href="clicked.html?i=sameurl.txt">sameURL.txt(2)</a></p>
<p><a href="clicked.html?i=samenameandurl">samenameandurl</a></p>
<p><a href="clicked.html?i=samenameandurl">samenameandurl</a></p>
<p><a href="clicked.html?i=s%20pace.html">s pace.html</a></p>
<p><a href="clicked.html?i=%E4uml">&auml;uml</a></p>
<p><a href="clicked.html?i=%2Fslash">/slash</a></p>
<p><input type="text" name="txtSomeOtherInput" size="40" value="An input box should not bother the Quay" /></p>
<p><a href="clicked.html?i=image%20with%20title"><img alt="image with title" title="Image title"/></a></p>
<p><a href="clicked.html?i=image%20with%20alt"><img alt="image with alt" /></a></p>
</div>
<div id="developmentBox">
<h3>Repos Quay development</h3>
<p><a href="tests/index.html">Automated test suite</a></p>
</div>
<!-- what's this doing here? is it used by the autosuggest.js script? -->
<div id="debugger"></div>



<!-- the Quay popup, should be written by the script if supported by autosuggest.js -->
<div id="quay">
	<!-- using onkeypress="return event.keyCode!=13" to disable browser's form handling on enter key -->
	<div id="quay_header">
		&nbsp;.: <a href="about.html">Repos Quay v.1.0</a> :. <a id="quayCloseIcon" href="javascript:hideQuay();"><img src="images/close_corner_button_normal.gif" /></a>
	</div>
	<div id="quay_mainarea">
		<input id="txtQuaySearch" name="textfield" type="text" />
	</div>
</div>
</body>
</html>


