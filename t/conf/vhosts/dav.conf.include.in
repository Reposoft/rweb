
# WebDAV configuration, expects an Alias /dav /my/path/to/files
# For troubleshooting define also a RewriteLog and RewriteLogLevel
# Also make sure that the path that dav is aliased to is allowed (test without dav config first)

# Using location to avoid host specific directive, might have drawbacks
    <Location /dav>
    #<Directory @ServerRoot@/hosts/multirepo/dav/>
        Dav on
	# get rid of lots of subrequests that pollute the rewrite log (not sure if it works in Location)
	DirectoryIndex index.html
	# Indexes required for dav browsing (I think), FollowSymLinks for rewrite + alias (or so I understood error.log)
        Options Indexes FollowSymLinks

        # how to authenticate a user
	AuthType Basic
	AuthName "repos test multirepo"
	AuthUserFile @ServerRoot@/hosts/multirepo/admin/repos-users
	Require valid-user

	# WebDAV access control and compatibility fixes relies on mod_rewrite
	RewriteEngine on

	# Microsoft webdav client folder support fix; it strips trailing slashes
#	RewriteCond %{HTTP_USER_AGENT} ^Microsoft.*
	# not needed inside location #RewriteCond %{REQUEST_URI} ^/dav/(.*[^/])$
	# The current fix relies on knowing the local path, to identify directory without subrequests
	# REQUEST_URI is urldecoded; can be used to check local path
	#RewriteCond @ServerRoot@/hosts/multirepo/dav/%1 -d
#	RewriteCond %{REQUEST_FILENAME} -d
	# Change URI internally, redirect would not be followed
#	RewriteRule ^(.*)$ $1/
	# Makes an internal redirect to the local path, but the request still results in redirect

	# 'user' section, access only folder==username
	# rule has to be here, not in host, for REMOTE_USER to be known without LA-U
	RewriteCond %{REQUEST_URI} ^/dav/user/([^/]+)/.*$
	RewriteCond %{REMOTE_USER}#%1 !^([^#]+)#(\1)$
	RewriteRule .* - [F]

	# all sections
    #</Directory>
    </Location>

    # public+share, don't require authentication for read access

	# Fix Windows WebDAV behavior for folder operations
	RewriteEngine on
	# WinXP client: Microsoft Data Access Internet Publishing Provider DAV
	RewriteCond %{HTTP_USER_AGENT} ^Microsoft.*
	RewriteCond %{REQUEST_URI} ^/dav/(.*[^/])$
	# REQUEST_URI is urldecoded; can be used to check local path
	# Must know what the alias maps to here, for performance I guess
	RewriteCond @ServerRoot@/hosts/multirepo/dav/%1 -d
	RewriteRule ^(.*)$ $1/ [PT]


